/*! EasyRecipe Plus 3.2.2925 Copyright (c) 2014 BoxHill LLC */
window.EASYRECIPE=window.EASYRECIPE||{},EASYRECIPE.widget=EASYRECIPE.widget||jQuery.widget,EASYRECIPE.button=EASYRECIPE.button||jQuery.fn.button,function(e){function t(e,t){var i;switch(Ht.show(),Ei.hide(),jt.show(),i=t.newTab?t.newTab.index():t.index){case 0:Ei.css("right","10px"),Ei.show();break;case 3:Ei.css("right","inherit"),jt.hide(),Ei.show();break;case 4:Ht.hide()}}function i(){Ti.off("change",i),fn=!0}function n(e){return e?(e+="",e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")):""}function a(t){return t?e("<div />").text(t).html():""}function r(t){return e.trim(a(t.val()))||!1}function s(){var e=Dt.tabs("option","active");Dt.tabs("option","active",++e)}function o(e){var t,i=/\[img +(.*?) *\/?]/i,n=/\[url ([^\]]+)](.*?\[\/url])/i,a=/\[cap ([^\]]+)](.*])(.*?)\[\/cap]/i;if(""!==e){for(t=i.exec(e);null!==t;)Wi.push(t[1].replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e.replace(i,"[img:"+Wi.length+"]"),t=i.exec(e);for(t=n.exec(e);null!==t;)$i.push(t[1]),e=e.replace(n,"[url:"+$i.length+"]$2"),t=n.exec(e);for(t=a.exec(e);null!==t;)Bi.push(t[1]),Yi.push(t[3].replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e.replace(a,"[cap:"+Bi.length+"]$2[/cap]"),t=a.exec(e)}return e}function l(e){var t,i,n,a=/\[img:(\d+)]/i,r=/\[url:(\d+)](.*?)\[\/url]/i,s=/\[cap:(\d+)](.*])\[\/cap]/i;if(e){for(n=a.exec(e);null!==n;)t=Wi[n[1]-1].replace(/&quot;/g,"&amp;quot;"),e=e.replace(a,"[img "+t+"]"),n=a.exec(e);for(n=r.exec(e);null!==n;)t=$i[n[1]-1],e=e.replace(r,"[url "+t+"]$2[/url]"),n=r.exec(e);for(n=s.exec(e);null!==n;)t=Bi[n[1]-1],i=Yi[n[1]-1],e=e.replace(s,"[cap "+t+"]$2"+i+"[/cap]"),n=r.exec(e)}return e}function c(e,t){var i,n,a,r,s,o,l,d,p,u,h,f,v,g,m,E,y,R,b,C,w,T,S,I,x,N=0,k=1,_=2,A=0,P="",L="<!-- START REPEAT ",M="<!-- START INCLUDEIF ",O="<!-- END INCLUDEIF ";for(i=e,t=t||{};;){if(s=i.length,o=i.indexOf("#",A),-1!==o&&(s=o,l=N),d=i.indexOf(L,A),-1!==d&&s>d&&(s=d,l=k),p=i.indexOf(M,A),-1!==p&&s>p&&(s=p,l=_),s===i.length)return P+i.substr(A);switch(u=s-A,P+=i.substr(A,u),A=s,l){case _:if(a=i.substr(A,44),r=Ni.exec(a),null===r)break;if(h=r[1],f="!"!==h,v=r[2],g=O+h+v+" -->",m=g.length,E=i.indexOf(g),-1===E){A++;break}y=typeof t[v]!==an&&t[v]!==!1,y===f?(R="<!-- START INCLUDEIF "+h+v+" -->",b=R.length,i=i.substr(0,A)+i.substr(A+b,E-A-b)+i.substr(E+m)):i=i.substr(0,A)+i.substr(E+m);break;case N:if(a=i.substr(A,22),r=ki.exec(a),null===r){P+="#",A++;continue}if(C=r[1],""!==t[C]&&!t[C]){P+="#"+C+"#",A+=C.length+2;continue}P+=t[C],A+=C.length+2;break;case k:if(a=i.substr(A,45),r=_i.exec(a),null===r){P+="<",A++;continue}if(w=r[1],!(t[w]&&t[w]instanceof Array)){P+="<",A++;continue}if(A+=w.length+22,T=i.indexOf("<!-- END REPEAT "+w+" -->",A),-1===T){P+="<!-- START REPEAT "+w+" -->";continue}for(S=T-A,I=i.substr(A,S),x=t[w],n=0;n<x.length;n++)P+=c(I,x[n]);A+=w.length+S+20}}}function d(t){var i,n,a=e.trim(t.val()),r=0,s=0;if(ht.hide(),""===a)return!0;if(Ut=Pi.exec(a),null===Ut){if(Ut=Li.exec(a),null===Ut)return ht.show(),!1;r=0,s=Ut[1]}else r=Ut[1]?parseInt(Ut[1],10):0,s=Ut[2]?parseInt(Ut[2],10):0;return 0===r&&0===s?t.val(""):(i=r>0?r+" hour":"",r>1&&(i+="s"),n=s>0?s+" min":"",s>1&&(n+="s"),t.val(e.trim(i+" "+n))),!0}function p(t){var i,n,a,r="";for(i=0;i<t.length;i++)n=t[i],3!==n.nodeType?1===n.nodeType&&n.childNodes.length>0&&(r+=p(n.childNodes)):(a=e.trim(n.nodeValue),""!==a&&(r+=a+"\n"));return r}function u(){var t;if(e(Qi,Ki).remove(),t=K.selection.getNode(),"#document"===t.nodeName&&(t=Mt[0]),"BODY"===t.nodeName.toUpperCase())e(t).hasClass("mceContentBody")||(t=Mt[0]),/^<p><br[^>]*><\/p>$/.test(t.innerHTML)?e(t).prepend(qi):e(t).append("&nbsp;"+qi);else{for(;t.parentNode&&"BODY"!==t.parentNode.nodeName.toUpperCase();)t=t.parentNode;t.parentNode?"DIV"===t.nodeName.toUpperCase()||"SPAN"===t.nodeName.toUpperCase()?e(t,Ki).after(qi):e(t,Ki).before(qi):(t=Mt[0],e(t).append("&nbsp;"+qi))}return hi=-1,e(Qi,Ki)}function h(){}function f(t){switch(t.type){case"js":e("head").append(e('<script type="text/javascript">'+t.js+"</script>")),Nt[t.f]();break;case"html":e(t.dest).html(t.html)}}function v(){Bt.unbind(nn),Yt.unbind(nn),Lt.dialog(tn),xi=!0,bt()}function g(t,i){var a,r,s,o="";for(r=t.recipe,"success"!==i&&(Lt.dialog(tn),xi=!0,bt()),tt.val(n(r.recipe_title)),r.rating&&e.isNumeric(r.rating)&&et.val(r.rating),pn=r.recipe_image,dt.val(""),r.author?ct.val(n(r.author)):ct.val(""),pt.val(r.cuisine||""),dt.val(r.mealType||""),ut.val(""),it.val(n(r.summary)),Ut=Di.exec(r.prep_time),null!==Ut?(a=Ut[1]?Ut[1]+"h ":"",rt.val(a+Ut[2]+"m")):rt.val(n(r.prep_time)),Ut=Di.exec(r.cook_time),null!==Ut?(a=Ut[1]?Ut[1]+"h ":"",st.val(a+Ut[2]+"m")):st.val(n(r.cook_time)),ot.val(n(r.yield)),Xt.val(n(r.serving_size)),r.nutrition?(s=r.nutrition,ei.val(n(s.calories)),ti.val(n(s.totalFat)),ii.val(n(s.saturatedFat)),ni.val(n(s.unsaturatedFat)),ai.val(n(s.transFat)),ri.val(n(s.totalCarbohydrates)),si.val(n(s.sugars)),oi.val(n(s.sodium)),li.val(n(s.dietaryFiber)),ci.val(n(s.protein)),di.val(n(s.cholesterol))):(ei.val(n(r.calories)),ti.val(n(r.fat))),a=0;a<t.ingredients.length;a++)o+=Ii(n(t.ingredients[a]))+"\n";nt.val(o),at.val(n(r.instructions.replace("\r",""))),pi.val(n(r.notes)),_t.easyrecipeDialog("option","title","Update Recipe"),Lt.dialog(tn),Gt.hide(),Vt.show(),$t.hide(),""!==pn&&Ci(pn,zt.length,!0),vt=u(),_t.easyrecipeDialog(rn)}function m(){var t;Wt.show(),Bt.unbind(nn),Yt.unbind(nn),t={action:"easyrecipeConvert",id:yt,type:Rt},e.post(ajaxurl,t,g,"json")}function E(t){var i,n,a,r,s,o,l,c,d,u,h,f,v,g=0,m="",E="",y="",R="",b=["instruction","method","cooking method","procedure","direction"],C=["ingredients?"],w=["note","cooking note"];for(h=e.parseJSON(Nt.ingredients),f=e.parseJSON(Nt.instructions),v=e.parseJSON(Nt.notes),-1===e.inArray(h,C)&&C.push(h),o="^\\s*(?:"+C.join("|")+")",d=new RegExp(o,"i"),-1===e.inArray(f,b)&&C.push(f),s="^\\s*(?:"+b.join("|")+")",c=new RegExp(s,"i"),-1===e.inArray(v,w)&&w.push(v),l="^\\s*(?:"+w.join("|")+")\\s*$",u=new RegExp(l,"i"),r=e("<div>"+t+"</div>"),i=p(r[0].childNodes),i=i.split("\n"),n=0;n<i.length;n++)if(a=e.trim(i[n]),""!==a)if(c.test(a))g=2;else if(d.test(a))g=1;else if(u.test(a))g=3;else switch(g){case 0:m+=a+"\n";break;case 1:E+=a+"\n";break;case 2:y+=a+"\n";break;case 3:R+=a+"\n"}return{summary:m,ingredients:E,instructions:y,notes:R}}function y(t){var i,n=e(".easyrecipe",Ki),a=e("#divERSELRecipes").find("ul");a.empty(),n.each(function(n){i=e(".ERName",this).text(),""===i&&(i="Recipe "+(n+1)),a.append(e("<li>"+i+"</li>").click(function(){Pt.dialog(tn),Ct(t,n)}))}),Pt.dialog(rn)}function R(t,i,n){var a,r=function(){var t,i,n,a,r=e.data(this,"index");t=this.width/150,i=this.height/112,t=t>i?t:i,n=Math.floor(this.height/t),a=Math.floor(this.width/t),zt[r].height(n),zt[r].width(a),zt[r].css("top",(112-n)/2),zt[r].attr("src",this.src),0===r&&e("#ERDTabs").find(".divERNoPhotos").remove()};Ft.append('<div class="ERPhoto"><img style="position:relative" id="ERPhoto_'+i+'" /></div>'),zt[i]=e("#ERPhoto_"+i,Ft),zt[i].data("src",t),n&&(e(".ERPhoto",Ft).removeClass(sn),zt[i].parent().addClass(sn),gi=i,pn=t),""===Ri&&(Ri=t),a=new Image,e.data(a,"index",i),a.onload=r,a.src=t}function b(){R(vi.val(),zt.length,!0),vi.val(""),fi.hide(),e(".divERNoPhotos").remove()}function C(e,t){var i,n=!1;for(i=0;i<zt.length;i++)if(zt[i].data("src")===e){n=!0;break}n||R(e,zt.length,t)}function w(t,a){var r,s,l,c,d,p,g,b,w,T,S,I,x,N,k,_,A,P,L,M=!1,O=!1,U={},D="",H="",j="",z="";if(!t||1===t.which){if(t&&t.data===dn&&(a=dn,t=t.delegateTarget),typeof a===an&&Xi>1)return Xi=e(".easyrecipe",Ki).length,y(t),void 0;if(vt=e(".easyrecipe",Ki),a===dn){for(b=0;b<vt.length;b++)if(vt[b]===t){hi=b;break}vt=e(t)}if(typeof a===an&&typeof t===an&&(hi=0),a!==cn&&vt.length>1&&(vt=e(vt[a]),hi=a),l=0,l=1,x=e.support.cors?"json":"jsonp",e.ajax(on,{dataType:x,data:{v:Nt.version,p:l,u:Nt.wpurl},success:f,error:h}),X=!1,typeof tinyMCE!==an&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&(X=!0),!X)return alert("You must use the Visual Editor to add or update an EasyRecipe"),void 0;if(tt.val(""),dt.val(""),pt.val(""),ut.val(""),ct.val(""),it.val(""),rt.val(""),st.val(""),ot.val(""),nt.val(""),at.val(""),Xt.val(""),ei.val(""),ti.val(""),ii.val(""),ni.val(""),ai.val(""),ri.val(""),si.val(""),oi.val(""),li.val(""),ci.val(""),di.val(""),pi.val(""),a!==cn&&1===vt.length)_t.easyrecipeDialog("option","title","Update Recipe"),$t.hide(),Gt.hide(),Vt.show(),gt=!0;else{if(ft=K.getContent(),!xi&&(S=Mi.exec(ft)||Oi.exec(ft)||Ui.exec(ft),S||(M=e("#hasRecipe").is(":checked")),S||M||(s=Ki.find(".hrecipe").filter(".f1",".f2"),s.length>0&&(O=-1!==s.text().indexOf("recipage.com"))),S||M||O))return M?(Rt="recipress",yt=Nt.postID):O?(Rt="recipage",yt=Nt.postID):(Rt=S[2],yt=S[3]),Wt.hide(),Bt.click(v),Yt.click(m),g=Fi[Rt],T=e("#txtERCNVText1",Lt),T.html(T.html().replace("#plugin#",g)),Ft.html(""),gi=-1,zt=[],Ft.html(ln),Lt.dialog(rn),void 0;Nt.isGuest&&(A=e("#inpERAuthor").val()||"",ct.val(A)),Gt.show(),Vt.hide(),$t.show(),_t.easyrecipeDialog("option","title","Add a New Recipe"),gt=!1,wt!==!1?U=E(wt):(_=K.selection.getContent(),_.length>20&&(U=E(_))),U.summary&&(D=U.summary),U.ingredients&&(H=U.ingredients),U.instructions&&(j=U.instructions),U.notes&&(z=U.notes),vt=u()}for(vt.find(".hiddenGrammarError, .hiddenSpellError, .hiddenSuggestion").each(function(){var t;e(this).parent(".mceItemHidden").length>0&&e(this).unwrap(),t=e(this).text(),e(this).replaceWith(t)}),P=vt,vt=e("<div>"+vt.html()+"</div>"),e("#inpERCuisine").autocomplete({source:e.parseJSON(Nt.cuisines)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />'),e("#inpERType").autocomplete({source:e.parseJSON(Nt.recipeTypes)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />'),fn=!1,Ti.off("change",i).on("change",i),yi=a!==cn?vt.find(".endeasyrecipe").text():Nt.version,""===yi&&(yi="2.2"),r=!!vt.find("div.endeasyrecipe").attr("title"),pn=e('link[itemprop="image"]',vt).attr("href")||"",Ft.html(""),gi=-1,Ri="",zt=[],Ki.find("img").each(function(t){var i=!1;"3">yi?e(this).hasClass("photo")&&(i=!0):i=this.src===pn,R(this.src,t,i)}),p=Ki.contents().text(),S=Hi.exec(p),N=zt.length;null!==S;)d=zi.exec(S[0]),null!==d&&(c=d[1],R(c,N),yi>"3"?pn===c&&(zt[N].parent().addClass(sn),gi=N):ji.test(S[0])&&(zt[N].parent().addClass(sn),gi=N,pn=c),N++),S=Hi.exec(p);""!==pn&&C(pn,!0),Et=e("#set-post-thumbnail").find("img").attr("src"),Et&&C(Et,-1===gi),-1===gi&&zt.length>0&&(gi=0,pn=Ri,zt[0].parent().addClass(sn)),Ft.click(function(t){"IMG"===t.target.nodeName&&(e(".ERPhoto",Ft).removeClass(sn),e(t.target).parent().addClass(sn),pn=t.target.src)}),0===zt.length?Ft.html(ln):-1===gi&&zt[0].parent().addClass(sn),Wi=[],$i=[],k=vt.find(".ERName .fn").html()||vt.find(".ERName").html(),k&&""!==k?tt.val(o(n(k))):tt.val(o(n(e("#title").val()))),dt.val(o(n(vt.find(".type").html()))),ct.val(o(n(vt.find(".author").html()))),""===ct.val()&&ct.val(o(e.parseJSON(Nt.author))),pt.val(o(n(vt.find(".cuisine").html()))),it.val(o(D+n(vt.find(".summary").html()))),r&&it.val(o(n(vt.find(".ERSSummary").html()))),yi>"3"?(I=vt.find('time[itemprop="prepTime"]').html()||"",rt.val(n(I)),I=vt.find('time[itemprop="cookTime"]').html()||"",st.val(n(I))):(I=vt.find(".preptime").html()||"",S=Ai.exec(I),null!==S?rt.val(n(S[1])):rt.val(""),I=vt.find(".cooktime").html()||"",S=Ai.exec(I),null!==S?st.val(n(S[1])):st.val("")),ot.val(n(vt.find(".yield").html())),vt.find(".ingredients li").each(function(t,i){H+=e(i).hasClass(Zi)?"!"+o(n(i.innerHTML))+"\n":o(n(i.innerHTML))+"\n"}),r&&""===H&&vt.find(".ingredient,.ERSIngredients .ERSSectionHead").each(function(t,i){H+=e(i).hasClass("ERSSectionHead")?"!"+o(n(i.innerHTML))+"\n":o(n(i.innerHTML))+"\n"}),nt.val(H),vt.find(".instructions li, .instructions .ERSeparator").each(function(t,i){w=e.trim(i.innerHTML.replace(/^[ 0-9.]*(.*)$/gi,"$1")),j+=e(i).hasClass(Zi)?"!"+w+"\n":w+"\n"}),r&&""===j&&vt.find(".instruction,.ERSInstructions .ERSSectionHead").each(function(t,i){w=e.trim(i.innerHTML.replace(/^[ 0-9.]*(.*)$/gi,"$1")),j+=e(i).hasClass("ERSSectionHead")?"!"+w+"\n":w+"\n"}),at.val(o(n(j))),Xt.val(n(vt.find(".servingSize").html())),ei.val(n(vt.find(".calories").html())),ti.val(n(vt.find(".fat").html())),ii.val(n(vt.find(".saturatedFat").html())),ni.val(n(vt.find(".unsaturatedFat").html())),ai.val(n(vt.find(".transFat").html())),ri.val(n(vt.find(".carbohydrates").html())),si.val(n(vt.find(".sugar").html())),oi.val(n(vt.find(".sodium").html())),li.val(n(vt.find(".fiber").html())),ci.val(n(vt.find(".protein").html())),di.val(n(vt.find(".cholesterol").html())),L=P.parent().prop("data-rating"),et.val(e.isNumeric(L)?L:"5"),w=(n(vt.find(".ERNotes").html())||"").replace(/<\/p>\n*<p>/gi,"\n\n").replace(/(?:<p>|<\/p>)/gi,"").replace(/<br *\/?>/gi,"\n"),""===w&&""!==z&&(w=z),w=o(w),w=w.replace(/\[br(?: ?\/)?]/gi,"\n"),pi.val(o(w)),r&&""===w&&(w=(n(vt.find(".ERSNotes").html())||"").replace(/<\/p>\n*<p>/gi,"\n\n").replace(/(?:<p>|<\/p>)/gi,"").replace(/<br *\/?>/gi,"\n"),""===w&&""!==z&&(w=z),w=o(w),w=w.replace(/\[br(?: ?\/)?]/gi,"\n"),w=w.replace(/ data-mce-href="[^"]+?"/gi,""),w=w.replace(/<a ([^>]+?)>([^<]+?)<\/a>/gi,"[url $1]$2[/url]"),pi.val(o(w))),wi&&(wi.name&&tt.val(o(n(wi.name))),wi.author&&ct.val(o(wi.author)),wi.summary&&it.val(o(wi.summary)),wi.yield&&ot.val(n(wi.yield)),wi.type&&dt.val(o(n(wi.type))),wi.cuisine&&pt.val(o(n(wi.cuisine))),wi.prepTime&&rt.val(n(wi.prepTime)),wi.cookTime&&st.val(n(wi.cookTime)),wi.summary&&it.val(o(wi.summary))),vt=P,_t.easyrecipeDialog(rn),_t.easyrecipeDialog("option","position","center")}}function T(t){return Xi=e(".easyrecipe",Ki).length,en||0===Xi?(w(t,cn),void 0):(At.dialog(rn),void 0)}function S(){_t.easyrecipeDialog(tn)}function I(){Pt.dialog(tn)}function x(){var e=confirm("Are you sure you want to delete this recipe?");e&&(vt.remove(),vt=!1,fn=!1),_t.easyrecipeDialog(tn)}function N(){var t,i=e("#inpERPaste"),n=i.val();t=E(n),(0!==t.ingredients.length||0!==t.instructions.length)&&(wt=n,i.val(""),wi={name:l(a(tt.val())),author:l(r(ct)),yield:r(ot),type:l(r(dt)),cuisine:l(r(pt)),summary:l(r(it)),servesize:r(Xt),prepTime:rt.val(),cookTime:st.val()},fn=!1,_t.easyrecipeDialog(tn),T(null))}function k(t){var i=e(t.target).parent(),n=i.parent();i.hasClass("easyrecipeAbove")?n.before(un):n.after(un),i.remove(),_()}function _(){var t,i,n;i=e("<div>"+Ki[0].body.innerHTML+"</div>"),i.find(".easyrecipeAbove,.easyrecipeBelow").remove(),t=i.find(".easyrecipe"),t.each(function(){var t=e(this);t.parent().hasClass("easyrecipeWrapper")&&t.unwrap(),bi(t)}),n=i.html(),K.setContent(n),t=Ki.find(".easyrecipe"),t.on("mousedown",null,dn,w),Ki.find(".ERInsertLine").on(nn,k)}function A(e){var t,i,n,a,r;if(a=e.prev(),r=e.next(),i=0===a.length||a.hasClass("easyrecipe")||a.hasClass("easyrecipeWrapper"))try{i=!(e[0].previousSibling&&3===e[0].previousSibling.nodeType)}catch(s){}if(n=0===r.length||r.hasClass("easyrecipe")||r.hasClass("easyrecipeWrapper"))try{n=!(e[0].nextSibling&&3===e[0].nextSibling.nodeType)}catch(s){}(i||n)&&(e.wrap('<div class="easyrecipeWrapper mceNonEditable" />'),t=e.parent(),i&&(t.prepend('<div class="easyrecipeAbove mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line above" /></div>'),t.find("input").on(nn,k),hn.push(t.find(".easyrecipeAbove")[0])),n&&(t.append('<div class="easyrecipeBelow mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line below" /></div>'),t.find("input").on(nn,k)))}function P(t){e(".easyrecipeAbove,.easyrecipeBelow",t).remove(),e(".easyrecipe",t).unwrap()}function L(){var t=e(".easyrecipe",Ki);0!==t.length&&(t.on("mousedown",null,dn,w),_())}function M(){var t,i,n,s,o,p,u,h,f,v,g,m,E,y,R="",b="",C=0,w="",T=[];if(d(rt)&&d(st)){for(i=e.trim(rt.val()),""!==i?(Ut=Pi.exec(i),n=Ut[1]?parseInt(Ut[1],10):0,s=Ut[2]?parseInt(Ut[2],10):0,C=60*n+s,o=n>0?n+"H":"",p=s>0?s+"M":"",b="PT"+o+p):i=!1,t=e.trim(st.val()),""!==t?(Ut=Pi.exec(t),n=Ut[1]?parseInt(Ut[1],10):0,s=Ut[2]?parseInt(Ut[2],10):0,o=n>0?n+"H":"",p=s>0?s+"M":"",C+=60*n+s,R="PT"+o+p):t=!1,C>0?(n=Math.floor(C/60),s=C%60,o=n>0?n+" hour":"",n>1&&(o+="s"),p=s>0?s+" min":"",s>1&&(p+="s"),C=e.trim(o+" "+p),o=n>0?n+"H":"",p=s>0?s+"M":"",w="PT"+o+p):C=!1,u=nt.val().split("\n"),f=0;f<u.length;f++)h=u[f],""!==h&&("!"===h.charAt(0)?(v=!0,h=h.substr(1)):v=!1,T.push({ingredient:l(a(h)),hasHeading:v}));for(u=at.val().split("\n"),m=[],g={INSTRUCTIONS:[]},f=0;f<u.length;f++)h=e.trim(u[f].replace(/^[ 0-9\.]*(.*)$/gi,"$1")),""!==h&&("!"===h.charAt(0)?((g.INSTRUCTIONS.length>0||g.heading)&&m.push(g),h=h.substr(1),g={},g.INSTRUCTIONS=[],g.heading=l(a(h))):g.INSTRUCTIONS.push({instruction:l(a(h))}));(g.INSTRUCTIONS.length>0||g.heading)&&m.push(g),h=r(pi),h&&(h=h.replace(/\n/g,"[br]")),E={version:Nt.version,hasPhoto:""!==pn,photoURL:pn,name:l(a(tt.val())),author:l(r(ct)),preptime:i,cooktime:t,totaltime:C,preptimeISO:b,cooktimeISO:R,totaltimeISO:w,yield:r(ot),type:l(r(dt)),cuisine:l(r(pt)),summary:l(r(it)),servesize:r(Xt),calories:r(ei),fat:r(ti),satfat:r(ii),unsatfat:r(ni),transfat:r(ai),carbs:r(ri),sugar:r(si),sodium:r(oi),fiber:r(li),protein:r(ci),cholesterol:r(di),notes:l(h),rating:et.length?et.val():"0",INGREDIENTS:T,STEPS:m},""===E.name&&(E.name=!1),y=c(Nt.recipeTemplate,E),-1===hi?vt=e(Qi,Ki):(vt=e(".easyrecipe",Ki),vt.length>0&&(vt=e(vt[hi]))),vt.before(y),vt.remove(),vt=!1,ui.css("display","inline-block"),fn=!1,_t.easyrecipeDialog(tn),Xi=e(".easyrecipe",Ki).length,L()}}function O(t,i){var n,a;if(wi=!1,tinymce.majorVersion>"3"){if(!lt[i.id]&&"wp_mce_fullscreen"!==i.id)return e("#"+i.controlManager.buttons.easyrecipeTest._id).hide(),e("#"+i.controlManager.buttons.easyrecipeEdit._id).hide(),e("#"+i.controlManager.buttons.easyrecipeAdd._id).hide(),void 0;lt[i.id]?(Ki=e("#"+i.id+"_ifr").contents(),Ot=1e4,n=e("#"+i.controlManager.buttons.easyrecipeTest._id),ui=e("#"+i.controlManager.buttons.easyrecipeEdit._id)):(Ki=e("#wp_mce_fullscreen_ifr").contents(),Ot=200001,n=e("#mce_fullscreen_easyrecipeTest"),ui=e("#mce_fullscreen_easyrecipeEdit"))}else{if(!lt[i.editorId]&&"wp_mce_fullscreen"!==i.editorId)return e("#"+i.editorId+"_easyrecipeTest").hide(),e("#"+i.editorId+"_easyrecipeEdit").hide(),e("#"+i.editorId+"_easyrecipeAdd").hide(),void 0;lt[i.editorId]?(Ki=e("#"+i.editorId+"_ifr").contents(),Ot=1e4,n=e("#"+i.editorId+"_easyrecipeTest"),ui=e("#"+i.editorId+"_easyrecipeEdit")):(Ki=e("#wp_mce_fullscreen_ifr").contents(),Ot=200001,n=e("#mce_fullscreen_easyrecipeTest"),ui=e("#mce_fullscreen_easyrecipeEdit"))}Mt=e("body",Ki),a=e(".easyrecipe",Ki),K=tinyMCE.activeEditor,a.each(function(){var t=e(this);t.addClass("mceNonEditable"),t.find(".ERRatingOuter").remove(),t.find(".ERHDPrint").remove(),t.find(".ERLinkback").remove(),t.find(".endeasyrecipe").attr("title")}),Xi=a.length,Xi>0&&""!==Nt.testURL?n.show():n.hide(),Xi>0?ui.css("display","inline-block"):ui.hide(),Ki.hasERCSS||(e("head",Ki).append('<link rel="stylesheet" type="text/css" href="'+Nt.easyrecipeURL+"/css/easyrecipe-entry.css?ver="+Nt.version+'" />'),Ki.hasERCSS=!0),L()}function U(){qt.toggleClass("ERNone"),Qt.toggleClass("ERContract")}function D(){Zt.toggleClass("ERNone"),Kt.toggleClass("ERContract")}function H(t){var i,n,a,r;i=e("#ertmp_"+Ji,Ki),n=t.title?' title="'+t.title+'"':"",a=t.target?' target="'+t.target+'"':"",r='href="'+t.href+'"'+a+n,$i.push(r),xt.val(It.substring(0,Tt)+"[url:"+$i.length+"]"+It.substring(Tt,St)+"[/url]"+It.substring(St)),xt[0].focus(),i.remove()}function j(t){var i,n,a,r,s,o;Nt.isEntryDialog&&(i=e("#ertmp_"+Ji,Ki),"string"==typeof t?a=e(t):(o=i.html(),"link"===o?(a=i.parent("a"),i=a):a=e(i.html())),a.is("a")&&(n=a.attr("href"),r=a.attr("title"),s=a.attr("target"),r=r?' title="'+r+'"':"",s=s?' target="'+s+'"':"",t='href="'+n+'"'+s+r,$i.push(t),xt.val(It.substring(0,Tt)+"[url:"+$i.length+"]"+It.substring(Tt,St)+"[/url]"+It.substring(St))),xt[0].focus(),i.remove())}function z(t,i){var n,a,r,s,o,l,c,d,p,u,h,f,v,g,m;a=t.sizes[i.size],r=a.url,l=a.width,c=a.height,R(r,zt.length),d=tinymce.html.Entities.encodeAllRaw(e.trim(t.title)),d=d.replace(/&quot;/g,"&amp;quot;"),p=tinymce.html.Entities.encodeAllRaw(e.trim(t.alt)),p=p.replace(/&quot;/g,"&amp;quot;"),u=tinymce.html.Entities.encodeAllRaw(e.trim(t.caption)),d=""!==d?' title="'+d+'"':"",p=""!==p?' alt="'+p+'"':"",h="align"+i.align,o=t.uploadedTo?'id="attachment_'+t.uploadedTo+'" ':"",n=It.substring(0,Tt),""!==u?(Bi.push(o+'align="'+h+'" width="'+l+'"'),Yi.push(u),f="[cap:"+Bi.length+"]",v="[/cap]",h=""):f=v="","none"===i.link?s=g=m="":"file"===i.link?s=r:"post"===i.link?s=t.link:"custom"===i.link&&(s=i.linkUrl),""!==s&&($i.push('href="'+s+'"'),g="[url:"+$i.length+"]",m="[/url]"),Wi.push('src="'+r+'" width="'+l+'" height="'+c+'" class="'+h+" size-"+i.size+'"'+d+p),n+=f+g+"[img:"+Wi.length+"]"+m+v,n+=It.substring(St),xt.val(n),xt[0].focus()}function F(){var e;Nt.isGuest?Nt.doUpload():(Si||(Si=wp.media({title:"Select Image",multiple:!1,library:{type:"image"},button:{text:"add image"}}),Si.on("content:create:browse",function(t){e=t.view,t.view.options.display=!0}),Si.on("select",function(){var t=Si.state().get("selection"),i=e.sidebar.get("display").model.attributes,n=t.models[0].attributes;z(n,i)})),Si.open())}function $(t){var i,n,a,r=!1;if(t.stopPropagation(),Vi){if(Vi.focus(),Tt=Vi[0].selectionStart,St=Vi[0].selectionEnd,It=Vi.val(),n=e(this),n.hasClass("ERIconBold")?(r="[b]",a="[/b]"):n.hasClass("ERIconUnderline")?(r="[u]",a="[/u]"):n.hasClass("ERIconItalic")?(r="[i]",a="[/i]"):n.hasClass("ERIconLineBreak")&&(r="[br]",a=""),r)return(Tt!==St||""===a)&&Vi.val(It.substring(0,Tt)+r+It.substring(Tt,St)+a+It.substring(St)),Vi[0].focus(),void 0;if(n.hasClass("ERIconImage")&&(xt=Vi,F()),n.hasClass("ERIconLink")){if(Tt===St)return;xt=Vi,Ji++,i=e('<div class="erdeleteme" id="ertmp_'+Ji+'">link</div>'),i.appendTo(Mt),K.selection.select(i[0].firstChild),K.nodeChanged(),Nt.isGuest?K.execCommand("WP_Link",!1):K.execCommand("WP_Link",!1)}}}function W(){wi=!1,T()}function B(){wi=!1,w()}function Y(){Xi>0&&!Nt.noHTMLWarn&&(Nt.noHTMLWarn=!0,kt.dialog(rn))}function G(t){var i,n,a,r,s=e("#wp-preview",t.target).val();return"dopreview"===s?!0:0===Xi?!0:(a=tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden(),a?n=e("<div>"+K.getContent()+"</div>"):(r=e("#wp-content-editor-container").find("textarea"),n=e("<div>"+r.val()+"</div>")),P(e(".easyrecipeWrapper",n)),e(".easyrecipe",n).removeClass("mceNonEditable"),i=e.trim(n.html()),a?K.setContent(i):r.val(i),!0)}function V(t){var i,n,a,r,s,o,l,c,d;d=e("#easyrecipe-snippet").find(".ERRSP"),l=d.find(".ERRSPStatus"),o=e.parseJSON(t),s=e(o.html),c=s.find("#ires .vsc"),0===c.length&&(c=s.find("#ires .rc")),0===c.length?(l.text("No snippet data returned from Google"),l.css("color","#f99")):(a=c.find("h3.r").text(),r=c.find(".s").html(),n=d.find(".ERRSPResult"),i="<h3>"+a+'</h3><div class="s">'+r+"</div>",n.html(i),l.hide(),d.find(".ERRSPResult .f.slp .csb").css("background-image",""))}function J(){}function q(t){e.ajax({url:ajaxurl,type:"POST",data:{action:"easyrecipeSnippet",id:t},success:V,error:J})}function Q(t){var i;""!=t.target.innerHTML&&(i=e(t.target).find("img").attr("src"),i&&C(i,!1))}function Z(t){var i,n,a,r;for(i=t[0],n=0;n<i.addedNodes.length;n++)if(a=e(i.addedNodes[n].innerHTML),r=a.find("img").attr("src")){C(r,!1);break}}var K,X,et,tt,it,nt,at,rt,st,ot,lt,ct,dt,pt,ut,ht,ft,vt,gt,mt,Et,yt,Rt,bt,Ct,wt,Tt,St,It,xt,Nt,kt,_t,At,Pt,Lt,Mt,Ot,Ut,Dt,Ht,jt,zt,Ft,$t,Wt,Bt,Yt,Gt,Vt,Jt,qt,Qt,Zt,Kt,Xt,ei,ti,ii,ni,ai,ri,si,oi,li,ci,di,pi,ui,hi,fi,vi,gi,mi,Ei,yi,Ri,bi,Ci,wi,Ti,Si,Ii=jQuery.trim,xi=!1,Ni=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i,ki=/^#([_a-z][_0-9a-z]{0,19})#/im,_i=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m,Ai=/^([^<]*)/,Pi=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,Li=/^([0-9]+)$/,Mi=/(.*)\[amd-(recipeseo|zlrecipe)-recipe:([0-9]+)](.*)/,Oi=/(.*)\[(yumprint)-recipe\s+id='(\d+)'](.*)/i,Ui=/(.*)\[(gmc)_recipe\s+([0-9]+)](.*)/,Di=/PT(?:([0-9]*)+H)?([0-9]+)+M/i,Hi=/\[(?:img) +(?:[^\]]+?)]/gi,ji=/class\s*=\s*"(?:[^"]+ )?photo[ "]/i,zi=/src\s*=\s*" *([^"]+?) *"/i,Fi={recipeseo:"Recipe SEO",ziplist:"ZipList",zlrecipe:"ZipList",yumprint:"Yumprint Recipe Card",recipress:"ReciPress",gmc:"GetMeCooking",recipage:"ReciPage"},$i=[],Wi=[],Bi=[],Yi=[],Gi="Switch to the Visual Editor to add or edit an EasyRecipe",Vi=null,Ji=0,qi='<div class="easyrecipeholder">EasyRecipe</div>',Qi=".easyrecipeholder",Zi="ERSeparator",Ki=null,Xi=0,en=!0,tn="close",nn="click",an="undefined",rn="open",sn="ERPhotoSelected",on="http://www.easyrecipeplugin.com/checkUpdates.php",ln='<div class="divERNoPhotos">There are no photos in this post<br />Add photos anywhere in the post</div>',cn=-1,dn=-2,pn="",un="&nbsp;",hn=[],fn=!1;e(function(){var i,n,a,r,o,l=null;Nt=EASYRECIPE,Nt.dialogs=e("<div>").addClass("easyrecipeUI").prop("id","easyrecipeUI").appendTo("body"),Nt.isGuest&&Nt.dialogs.addClass("easyrecipeDlgAbsolute"),e.widget("custom.easyrecipeDialog",e.ui.dialog,{_allowInteraction:function(t){return this._super(t)||!!e(t.target).parents(".media-modal-content, #wp-link").length}}),Nt.button!==e.fn.button&&(l=e.fn.button,e.fn.button=Nt.button),_t=e("#easyrecipeEntry"),Pt=e("#easyrecipeSelect"),kt=e("#easyrecipeHTMLWarn"),lt=Nt.isGuest?{guestpost:1}:{content:1,aviaTBcontent:1},Pt.dialog({autoOpen:!1,width:340,modal:!0,appendTo:Nt.dialogs,dialogClass:"easyrecipeSelect",close:function(){e(".easyrecipeSelect").filter(function(){return""===e(this).text()}).remove()}}),e("#divERSELContainer").show(),_t.easyrecipeDialog({autoOpen:!1,width:655,modal:!0,appendTo:Nt.dialogs,dialogClass:"easyrecipeEntry",beforeClose:function(){if(fn){if(!window.confirm("Are you sure you want to close without saving the recipe?"))return!1;fn=!1}return!0},close:function(){Nt.isEntryDialog=!1,vt&&!gt&&vt.remove(),vt=!1,e(".easyrecipeEntry").filter(function(){return""===e(this).text()}).remove()},open:function(){Nt.isEntryDialog=!0,Dt.tabs({active:0,beforeActivate:t}),setTimeout(function(){var t=e(".easyrecipeEntry"),i=t.offset();i.top<mi&&(i.top=mi,t.offset(i))},250)}}),Ti=e("#divERContainer").show(),kt.dialog({autoOpen:!1,width:420,modal:!0,dialogClass:"easyrecipeHTMLWarn",appendTo:Nt.dialogs,close:function(){e(".easyrecipeHTMLWarn").filter(function(){return""===e(this).text()}).remove()}}),e(".divERHTMLWarnContainer").show(),Lt=e("#easyrecipeConvert"),Wt=e("#divERCNVSpinner"),Bt=e("#btnERCNVCancel"),Yt=e("#btnERCNVOK"),Wt.hide(),Lt.dialog({autoOpen:!1,width:390,modal:!0,dialogClass:"easyrecipeConvert",appendTo:Nt.dialogs,close:function(){e(".easyrecipeConvert").filter(function(){return""===e(this).text()}).remove()}}),e("#divERCNVContainer").show(),e(window).bind("easyrecipeadd",W),e(window).bind("easyrecipeedit",B),e(window).bind("easyrecipeload",O),jt=e("#divERNext"),Ht=e("#btnERButtons"),Dt=e("#ERDTabs"),Ft=e("#divERPhotos"),e("input:submit",".easyrecipeUI").button(),mt=e("#ed_toolbar"),et=e("#inpERRating"),tt=e("#inpERName"),ct=e("#inpERAuthor"),dt=e("#inpERType"),pt=e("#inpERCuisine"),ut=e("#inpERTags"),it=e("textarea#taERSummary"),nt=e("textarea#taERIngredients"),at=e("textarea#taERInstructions"),rt=e("#inpERPrepTime"),st=e("#inpERCookTime"),ot=e("#inpERYield"),Xt=e("#inpERServeSize"),ei=e("#inpERCalories"),ti=e("#inpERFat"),ii=e("#inpERSatFat"),ni=e("#inpERUnsatFat"),ai=e("#inpERTransFat"),ri=e("#inpERCarbs"),si=e("#inpERSugar"),oi=e("#inpERSodium"),li=e("#inpERFiber"),ci=e("#inpERProtein"),di=e("#inpERCholesterol"),pi=e("textarea#taERNotes"),fi=e("#divERAddImageURL"),o=e("#lnkERPhotoURL"),ht=e(".ERTimeError"),Gt=e("#divERAdd"),Vt=e("#divERChange"),Jt=e("#divERHeader"),qt=e("#divEROther"),Qt=e("#divEROtherLabel"),Zt=e("#divERNotes"),Kt=e("#divERNotesLabel"),$t=e("#ERDPasteTab"),vi=e("#fldERAPUImageURL"),e("#btnERAdd").click(M),e("#btnERNext").click(s),e("#btnERChange").click(M),e("#btnERDelete").click(x),e("#btnERCancel").click(S),o.click(function(){fi.show(500)}),e("#btnERAIUCancel").click(function(){fi.hide()}),e("#btnERAIUOK").click(b),Qt.click(U),Kt.click(D),rt.change(function(t){d(e(t.target))}),st.change(function(t){d(e(t.target))}),e("#btnERPaste").click(N),e("#btnERSELCancel").click(I),mi=e("#wpadminbar").height(),Ei=e("#divEREditBtns").on("mousedown","li",$),Ti.find('input[type="text"], textarea').on("blur",function(){Vi=null}).on("focus",function(){Vi=e(this)}),e("#wp-link").bind("wpdialogclose",j),Nt.insertLink=H,bt=T,Ct=w,wt=!1,Nt.insertUploadedImage=z,bi=A,Ci=R,Nt.addListener=L,kt.find("input").on(nn,function(){kt.dialog(tn)}),e("#wp-content-editor-tools").on(nn,"#content-html",Y),e("#post").on("submit",G),null!==l&&(e.fn.button=l),a=e("#easyrecipe-snippet"),"none"!==a.css("display")&&(r=a.find(".ERRSPStatus").attr("postid"),r&&q(r)),i=e("#postimagediv").find(".inside"),window.MutationObserver&&i.length>0?(n=new MutationObserver(Z),n.observe(i[0],{childList:!0})):i.on("DOMSubtreeModified",Q),window.QTags&&QTags.addButton("easyrecipe","EasyRecipe",function(){alert(Gi)},"","","",900)})}(jQuery);