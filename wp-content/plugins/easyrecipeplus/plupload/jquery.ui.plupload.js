!function(t,e,l,a){function i(t){return l.translate(t)||t}function o(t){t.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="plupload"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+i("Select files")+'</div><div class="plupload_header_text">'+i("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><table class="plupload_filelist"><tr class="ui-widget-header plupload_filelist_header"><td class="plupload_cell plupload_file_name">'+i("Filename")+'</td><td class="plupload_cell plupload_file_status">'+i("Status")+'</td><td class="plupload_cell plupload_file_size">'+i("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_scroll"><table class="plupload_filelist_content"></table></div><table class="plupload_filelist"><tr class="ui-widget-header ui-widget-content plupload_filelist_footer"><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+i("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+i("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+i("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div></div></div><input class="plupload_count" value="0" type="hidden"></div>')}var s={};a.widget("ui.plupload",{contents_bak:"",runtime:null,options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var t,e,n=this;t=this.element.attr("id"),t||(t=l.guid(),this.element.attr("id",t)),this.id=t,this.contents_bak=this.element.html(),o(this.element),this.container=a(".plupload_container",this.element).attr("id",t+"_container"),this.filelist=a(".plupload_filelist_content",this.container).attr({id:t+"_filelist",unselectable:"on"}),this.browse_button=a(".plupload_add",this.container).attr("id",t+"_browse"),this.start_button=a(".plupload_start",this.container).attr("id",t+"_start"),this.stop_button=a(".plupload_stop",this.container).attr("id",t+"_stop"),a.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"}}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})),this.progressbar=a(".plupload_progress_container",this.container),a.ui.progressbar&&this.progressbar.progressbar(),this.counter=a(".plupload_count",this.element).attr({id:t+"_count",name:t+"_count"}),e=this.uploader=s[t]=new l.Uploader(a.extend({container:t,browse_button:t+"_browse"},this.options)),e.bind("Error",function(t,e){e.code===l.INIT_ERROR&&n.destroy()}),e.bind("Init",function(t,l){n.options.buttons.browse||(n.browse_button.button("disable").hide(),t.disableBrowse(!0)),n.options.buttons.start||n.start_button.button("disable").hide(),n.options.buttons.stop||n.stop_button.button("disable").hide(),!n.options.unique_names&&n.options.rename&&n._enableRenaming(),e.features.dragdrop&&n.options.dragdrop&&n._enableDragAndDrop(),n.container.attr("title",i("Using runtime: ")+(n.runtime=l.runtime)),n.start_button.click(function(t){a(this).button("option","disabled")||n.start(),t.preventDefault()}),n.stop_button.click(function(t){n.stop(),t.preventDefault()})}),n.options.max_file_count&&e.bind("FilesAdded",function(t,e){var l=[],a=e.length,o=t.files.length+a-n.options.max_file_count;o>0&&(l=e.splice(a-o,o),t.trigger("Error",{code:n.FILE_COUNT_ERROR,message:i("File count error."),file:l}))}),e.init(),e.bind("FilesAdded",function(t,e){n._trigger("selected",null,{up:t,files:e}),n.options.autostart&&setTimeout(function(){n.start()},10)}),e.bind("FilesRemoved",function(t,e){n._trigger("removed",null,{up:t,files:e})}),e.bind("QueueChanged",function(){n._updateFileList()}),e.bind("StateChanged",function(){n._handleState()}),e.bind("UploadFile",function(t,e){n._handleFileStatus(e)}),e.bind("FileUploaded",function(t,e){n._handleFileStatus(e),n._trigger("uploaded",null,{up:t,file:e})}),e.bind("UploadProgress",function(t,e){a("#"+e.id).find(".plupload_file_status").html(e.percent+"%").end().find(".plupload_file_size").html(l.formatSize(e.size)),n._handleFileStatus(e),n._updateTotalProgress(),n._trigger("progress",null,{up:t,file:e})}),e.bind("UploadComplete",function(t,e){n._trigger("complete",null,{up:t,files:e})}),e.bind("Error",function(t,e){var a,o,s=e.file;if(s){if(a="<strong>"+e.message+"</strong>",o=e.details)a+=" <br /><i>"+e.details+"</i>";else{switch(e.code){case l.FILE_EXTENSION_ERROR:o=i("File: %s").replace("%s",s.name);break;case l.FILE_SIZE_ERROR:o=i("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(t,e){switch(e){case"f":return s.name;case"s":return s.size;case"m":return l.parseSize(n.options.max_file_size)}});break;case n.FILE_COUNT_ERROR:o=i("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",n.options.max_file_count);break;case l.IMAGE_FORMAT_ERROR:o=l.translate("Image format either wrong or not supported.");break;case l.IMAGE_MEMORY_ERROR:o=l.translate("Runtime ran out of available memory.");break;case l.IMAGE_DIMENSIONS_ERROR:o=l.translate("Resoultion out of boundaries! <b>%s</b> runtime supports images only up to %wx%hpx.").replace(/%([swh])/g,function(e,l){switch(l){case"s":return t.runtime;case"w":return t.features.maxWidth;case"h":return t.features.maxHeight}});break;case l.HTTP_ERROR:o=i("Upload URL might be wrong or doesn't exist")}a+=" <br /><i>"+o+"</i>"}n.notify("error",a),n._trigger("error",null,{up:t,file:s,error:a})}})},_setOption:function(t,e){var l=this;"buttons"==t&&"object"==typeof e&&(e=a.extend(l.options.buttons,e),e.browse?(l.browse_button.button("enable").show(),up.disableBrowse(!1)):(l.browse_button.button("disable").hide(),up.disableBrowse(!0)),e.start?l.start_button.button("enable").show():l.start_button.button("disable").hide(),e.stop?l.start_button.button("enable").show():l.stop_button.button("disable").hide()),l.uploader.settings[t]=e},start:function(){this.uploader.start(),this._trigger("start",null)},stop:function(){this.uploader.stop(),this._trigger("stop",null)},getFile:function(t){var e;return e="number"==typeof t?this.uploader.files[t]:this.uploader.getFile(t)},removeFile:function(t){var e=this.getFile(t);e&&this.uploader.removeFile(e)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},_handleState:function(){var t=this,e=this.uploader;e.state===l.STARTED?(a(t.start_button).button("disable"),a([]).add(t.stop_button).add(".plupload_started").removeClass("plupload_hidden"),a(".plupload_upload_status",t.element).text(i("Uploaded %d/%d files").replace("%d/%d",e.total.uploaded+"/"+e.files.length)),a(".plupload_header_content",t.element).addClass("plupload_header_content_bw")):(a([]).add(t.stop_button).add(".plupload_started").addClass("plupload_hidden"),t.options.multiple_queues&&(a(t.start_button).button("enable"),a(".plupload_header_content",t.element).removeClass("plupload_header_content_bw")),t._updateFileList())},_handleFileStatus:function(t){var e,i;if(a("#"+t.id).length){switch(t.status){case l.DONE:e="plupload_done",i="ui-icon ui-icon-circle-check";break;case l.FAILED:e="ui-state-error plupload_failed",i="ui-icon ui-icon-alert";break;case l.QUEUED:e="plupload_delete",i="ui-icon ui-icon-circle-minus";break;case l.UPLOADING:e="ui-state-highlight plupload_uploading",i="ui-icon ui-icon-circle-arrow-w";var o=a(".plupload_scroll",this.container),s=o.scrollTop(),n=o.height(),d=a("#"+t.id).position().top+a("#"+t.id).height();d>n&&o.scrollTop(s+d-n)}e+=" ui-state-default plupload_file",a("#"+t.id).attr("class",e).find(".ui-icon").attr("class",i)}},_updateTotalProgress:function(){var t=this.uploader;this.progressbar.progressbar("value",t.total.percent),this.element.find(".plupload_total_status").html(t.total.percent+"%").end().find(".plupload_total_file_size").html(l.formatSize(t.total.size)).end().find(".plupload_upload_status").text(i("Uploaded %d/%d files").replace("%d/%d",t.total.uploaded+"/"+t.files.length))},_updateFileList:function(){var t,e,o=this,s=this.uploader,n=this.filelist,d=0,r=this.id+"_";a.ui.sortable&&this.options.sortable&&a("tbody",n).sortable("destroy"),n.empty(),a.each(s.files,function(i,p){e="",t=r+d,p.status===l.DONE&&(p.target_name&&(e+='<input type="hidden" name="'+t+'_tmpname" value="'+l.xmlEncode(p.target_name)+'" />'),e+='<input type="hidden" name="'+t+'_name" value="'+l.xmlEncode(p.name)+'" />',e+='<input type="hidden" name="'+t+'_status" value="'+(p.status===l.DONE?"done":"failed")+'" />',d++,o.counter.val(d)),n.append('<tr class="ui-state-default plupload_file" id="'+p.id+'"><td class="plupload_cell plupload_file_name"><span>'+p.name+'</span></td><td class="plupload_cell plupload_file_status">'+p.percent+'%</td><td class="plupload_cell plupload_file_size">'+l.formatSize(p.size)+'</td><td class="plupload_cell plupload_file_action"><div class="ui-icon"></div>'+e+"</td></tr>"),o._handleFileStatus(p),a("#"+p.id+".plupload_delete .ui-icon, #"+p.id+".plupload_done .ui-icon").click(function(t){a("#"+p.id).remove(),s.removeFile(p),t.preventDefault()}),o._trigger("updatelist",null,n)}),0===s.total.queued?a(".ui-button-text",o.browse_button).text(i("Add Files")):a(".ui-button-text",o.browse_button).text(i("%d files queued").replace("%d",s.total.queued)),s.files.length===s.total.uploaded+s.total.failed?o.start_button.button("disable"):o.start_button.button("enable"),n[0].scrollTop=n[0].scrollHeight,o._updateTotalProgress(),!s.files.length&&s.features.dragdrop&&s.settings.dragdrop?a("#"+t+"_filelist").append('<tr><td class="plupload_droptext">'+i("Drag files here.")+"</td></tr>"):o.options.sortable&&a.ui.sortable&&o._enableSortingList()},_enableRenaming:function(){var t=this;a(".plupload_delete .plupload_file_name span",this.filelist).live("click",function(e){var l,i,o,s=a(e.target),n="";l=t.uploader.getFile(s.parents("tr")[0].id),o=l.name,i=/^(.+)(\.[^.]+)$/.exec(o),i&&(o=i[1],n=i[2]),s.hide().after('<input class="plupload_file_rename" type="text" />'),s.next().val(o).focus().blur(function(){s.show().next().remove()}).keydown(function(t){var e=a(this);-1!==a.inArray(t.keyCode,[13,27])&&(t.preventDefault(),13===t.keyCode&&(l.name=e.val()+n,s.text(l.name)),e.blur())})})},_enableDragAndDrop:function(){this.filelist.append('<tr><td class="plupload_droptext">'+i("Drag files here.")+"</td></tr>"),this.filelist.parent().attr("id",this.id+"_dropbox"),this.uploader.settings.drop_element=this.options.drop_element=this.id+"_dropbox"},_enableSortingList:function(){var t=this;a("tbody tr",this.filelist).length<2||a("tbody",this.filelist).sortable({containment:"parent",items:".plupload_delete",helper:function(t,e){return e.clone(!0).find("td:not(.plupload_file_name)").remove().end().css("width","100%")},stop:function(){var e=[];a.each(a(this).sortable("toArray"),function(l,a){e[e.length]=t.uploader.getFile(a)}),e.unshift(e.length),e.unshift(0),Array.prototype.splice.apply(t.uploader.files,e)}})},notify:function(t,e){var l=a('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+i("Close")+'"></span><p><span class="ui-icon"></span>'+e+"</p></div>");l.addClass("ui-state-"+("error"===t?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===t?"alert":"info")).end().find(".plupload_message_close").click(function(){l.remove()}).end(),a(".plupload_header_content",this.container).append(l)},destroy:function(){a(".plupload_button",this.element).unbind(),a.ui.button&&a(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),a.ui.progressbar&&this.progressbar.progressbar("destroy"),a.ui.sortable&&this.options.sortable&&a("tbody",this.filelist).sortable("destroy"),this.uploader.destroy(),this.element.empty().html(this.contents_bak),this.contents_bak="",a.Widget.prototype.destroy.apply(this)}})}(window,document,plupload,jQuery);